<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta
        http-equiv="X-UA-Compatible"
        content="IE=edge"
    >
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0"
    >
    <title>Scrum Poker - Agile Scrum Estimation Tool</title>
    <meta
        name="description"
        content="Engage in interactive, fun, and effective Scrum planning with our free online Agile Scrum Master Game. Perfect for remote teams, this tool simplifies your Agile estimation and planning process."
    >
    <meta
        name="keywords"
        content="Scrum Game, Agile Planning Tool, Free Scrum Master Game, Online Estimation Tool, Agile Project Management, Scrum Planning Poker, Agile Collaboration Tool"
    >
    <meta
        name="author"
        content="Hakan SARIER"
    >

    <!-- Open Graph / Facebook -->
    <meta
        property="og:type"
        content="website"
    >
    <meta
        property="og:url"
        content="https://scrum-oiyf.onrender.com/"
    >
    <meta
        property="og:title"
        content="Agile Scrum Master Game - Free Online Collaborative Tool"
    >
    <meta
        property="og:description"
        content="Interactive and engaging Scrum planning tool for Agile teams. Simplify your estimation process with our free online game."
    >
    <!-- <meta property="og:image" content="https://scrum-oiyf.onrender.com/image.jpg"> -->

    <!-- Twitter -->
    <meta
        property="twitter:card"
        content="summary_large_image"
    >
    <meta
        property="twitter:url"
        content="https://scrum-oiyf.onrender.com/"
    >
    <meta
        property="twitter:title"
        content="Agile Scrum Master Game - Free Online Collaborative Tool"
    >
    <meta
        property="twitter:description"
        content="Interactive and engaging Scrum planning tool for Agile teams. Simplify your estimation process with our free online game."
    >
    <!-- <meta property="twitter:image" content="https://scrum-oiyf.onrender.com/image.jpg"> -->

    <!-- Favicon -->
    <link
        rel="icon"
        type="image/x-icon"
        href="favicon.png"
    >
    <link
        rel="stylesheet"
        href="index.css"
    >
    <script src="/socket.io/socket.io.js"></script>
    <script>

        let socket = io.connect('/');
        let currentRoom;
        let isMaster = false;
        let userName = '';
        let selectedAvatar = 'ğŸ‘¤'; // Default avatar
        let votesRevealed = false; // Track if votes are currently revealed
        const SESSION_DURATION = 6 * 60 * 60 * 1000; // 6 saat

        // Audio setup for mobile browser support
        let notificationAudio = null;
        let audioUnlocked = false;

        // Theme toggle functionality
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            const themeIcon = document.getElementById('themeIcon');

            html.setAttribute('data-theme', newTheme);
            themeIcon.textContent = newTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';

            localStorage.setItem('theme', newTheme);
        }

        // Load saved theme (default to dark)
        window.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            const themeIcon = document.getElementById('themeIcon');

            document.documentElement.setAttribute('data-theme', savedTheme);
            if (themeIcon) {
                themeIcon.textContent = savedTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
            }

            // Setup avatar selection
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.avatar-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    const radio = this.querySelector('input[type="radio"]');
                    if (radio) {
                        radio.checked = true;
                        selectedAvatar = radio.value;
                    }
                });
            });
        });

        // LocalStorage'dan session bilgilerini al
        function loadSession() {
            try {
                const sessionData = localStorage.getItem('scrumSession');
                if (sessionData) {
                    const session = JSON.parse(sessionData);
                    const now = Date.now();

                    // 6 saat iÃ§indeyse otomatik geri katÄ±l
                    if (now - session.timestamp < SESSION_DURATION) {
                        document.getElementById('username').value = session.name;
                        document.getElementById('room').value = session.room;
                        document.getElementById('isMaster').checked = session.isMaster;

                        // Restore avatar selection
                        if (session.avatar) {
                            selectedAvatar = session.avatar;
                            // Update UI to show selected avatar
                            document.querySelectorAll('.avatar-option').forEach(opt => {
                                opt.classList.remove('selected');
                                const radio = opt.querySelector('input[type="radio"]');
                                if (radio && radio.value === session.avatar) {
                                    opt.classList.add('selected');
                                    radio.checked = true;
                                }
                            });
                        }

                        return session;
                    } else {
                        // Session sÃ¼resi dolmuÅŸ, temizle
                        localStorage.removeItem('scrumSession');
                    }
                }
            } catch (e) {
                console.error('Session yÃ¼kleme hatasÄ±:', e);
            }
            return null;
        }

        // Session bilgilerini kaydet
        function saveSession(room, name, isMaster, avatar) {
            try {
                const sessionData = {
                    room: room,
                    name: name,
                    isMaster: isMaster,
                    avatar: avatar,
                    timestamp: Date.now()
                };
                localStorage.setItem('scrumSession', JSON.stringify(sessionData));
            } catch (e) {
                console.error('Session kaydetme hatasÄ±:', e);
            }
        }

        // Update connection status indicator
        function updateConnectionStatus(status) {
            const statusElement = document.getElementById('connectionStatus');
            if (!statusElement) return;

            if (status === 'connected') {
                statusElement.className = 'status-connected';
                statusElement.innerHTML = 'ğŸŸ¢ Connected';
            } else if (status === 'reconnecting') {
                statusElement.className = 'status-reconnecting';
                statusElement.innerHTML = 'ğŸŸ¡ Reconnecting...';
            } else if (status === 'disconnected') {
                statusElement.className = 'status-disconnected';
                statusElement.innerHTML = 'ğŸ”´ Disconnected';
            }
        }

        // Otomatik yeniden baÄŸlanma
        socket.on('disconnect', (reason) => {
            console.log('BaÄŸlantÄ± koptu:', reason);

            // Only update connection status if user is in a room
            if (currentRoom) {
                updateConnectionStatus('disconnected');
            }

            // Away durumunu otomatik ayarla
            if (currentRoom) {
                socket.emit('autoAway', { room: currentRoom, isAway: true });
            }

            // BirkaÃ§ saniye sonra yeniden baÄŸlanma durumunu gÃ¶ster
            setTimeout(() => {
                if (!socket.connected && currentRoom) {
                    updateConnectionStatus('reconnecting');
                }
            }, 1000);
        });

        socket.on('connect', () => {
            console.log('BaÄŸlantÄ± kuruldu');

            // Only update connection status if user is in a room
            if (currentRoom) {
                updateConnectionStatus('connected');
            }

            // Away durumunu kaldÄ±r
            if (currentRoom) {
                socket.emit('autoAway', { room: currentRoom, isAway: false });
            }

            // EÄŸer daha Ã¶nce bir odaya katÄ±ldÄ±ysa, otomatik geri katÄ±l
            const session = loadSession();
            if (session && currentRoom) {
                console.log('Otomatik olarak odaya geri katÄ±lÄ±nÄ±yor...');
                socket.emit('joinRoom', {
                    room: currentRoom,
                    name: userName,
                    isMaster: isMaster,
                    avatar: selectedAvatar
                });
            }
        });

        socket.on('connect_error', (error) => {
            console.error('BaÄŸlantÄ± hatasÄ±:', error);

            // Only update connection status if user is in a room
            if (currentRoom) {
                updateConnectionStatus('reconnecting');
            }
        });

        // Sayfa yÃ¼klendiÄŸinde eski session'Ä± kontrol et
        window.addEventListener('load', () => {
            const session = loadSession();
            if (session) {
                console.log('Ã–nceki session bulundu');
            }
        });

        // Recommended room selection
        function selectRoom(roomName) {
            document.getElementById('room').value = roomName;
        }

        // Toggle What's New modal
        function toggleWhatsNew() {
            const modal = document.getElementById('whatsNewModal');
            if (modal.style.display === 'flex') {
                modal.style.display = 'none';
            } else {
                modal.style.display = 'flex';
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('whatsNewModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // Return to login screen
        function returnToLogin() {
            document.getElementById('gameSection').classList.add('d-none');
            document.getElementById('joinSection').style.display = 'flex';
            document.getElementById('whatsNewButton').style.display = 'block';

            // Hide master controls
            document.getElementsByClassName('section-master')[0].classList.add('d-none');
            document.getElementById('revealBtn').style.display = 'none';
            document.getElementById('resetBtn').style.display = 'none';

            // Hide statistics
            votesRevealed = false; // Reset voting state
            document.getElementById('statisticsSection').style.display = 'none';

            // Disconnect from current room
            if (currentRoom) {
                socket.disconnect();
                socket.connect();
            }

            currentRoom = null;
            isMaster = false;
        }

        function joinRoom() {
            let name = document.getElementById('username').value;
            let room = document.getElementById('room').value;
            isMaster = document.getElementById('isMaster').checked;

            if (name && room) {
                // Unlock audio for mobile browsers on first user interaction
                unlockAudio();

                currentRoom = room;
                userName = name;

                // Session bilgilerini kaydet
                saveSession(room, name, isMaster, selectedAvatar);

                socket.emit('joinRoom', { room: currentRoom, name: name, isMaster: isMaster, avatar: selectedAvatar });

                // Always hide/show master controls based on current role
                if (isMaster) {
                    document.getElementsByClassName('section-master')[0].classList.remove('d-none');
                    document.getElementById('revealBtn').style.display = 'block';
                    document.getElementById('resetBtn').style.display = 'block';
                } else {
                    document.getElementsByClassName('section-master')[0].classList.add('d-none');
                    document.getElementById('revealBtn').style.display = 'none';
                    document.getElementById('resetBtn').style.display = 'none';
                }

                // Update user info display
                document.getElementById('userAvatarDisplay').textContent = selectedAvatar;
                document.getElementById('userNameDisplay').textContent = name;
                document.getElementById('userRoomDisplay').textContent = `Room: ${room}`;

                document.getElementById('joinSection').style.display = 'none';
                document.getElementById('gameSection').classList.remove('d-none');

                // Hide What's New button when entering room
                document.getElementById('whatsNewButton').style.display = 'none';

            } else {
                alert('ismini ve baÄŸlanmak istediÄŸin odayÄ± gir.');
            }
        }

        socket.on('updateUsers', function (users) {
            let userList = '';
            let userCount = Object.keys(users).length;

            // Sort users: master first, then others
            const sortedUsers = Object.values(users).sort((a, b) => {
                if (a.isMaster) return -1;
                if (b.isMaster) return 1;
                return 0;
            });

            sortedUsers.forEach((user) => {
                const breakClass = user.requestBreak ? 'has-break-request' : '';
                const questionClass = user.hasQuestion ? 'has-question' : '';
                const awayClass = user.isAway ? 'is-away' : '';
                const masterClass = user.isMaster ? 'is-master' : '';

                // Determine vote display based on whether votes are revealed
                let voteDisplay;
                let revealedClass = '';

                if (votesRevealed) {
                    // If votes are revealed, show actual values
                    revealedClass = 'vote-revealed';
                    if (user.isMaster) {
                        voteDisplay = 'ğŸ¥º';
                    } else if (user.isAway) {
                        voteDisplay = 'ğŸ’¤';
                    } else if (user.vote === 'â˜•') {
                        voteDisplay = 'â˜•';
                    } else if (user.vote !== null && user.vote !== 'null') {
                        voteDisplay = user.vote;
                    } else {
                        voteDisplay = 'ğŸ¥º';
                    }
                } else {
                    // If votes not revealed, show status text
                    voteDisplay = user.isMaster ? 'Voted' : (user.isAway ? 'ğŸ’¤' : (user.vote !== null ? 'Voted' : 'Not voted'));
                }

                const masterBadge = user.isMaster ? ' ğŸ‘‘' : '';
                const userAvatar = user.avatar || 'ğŸ‘¤';

                // Add vibrate button only for Scrum Master and not for themselves
                const vibrateButton = (isMaster && !user.isMaster)
                    ? `<button class="vibrate-btn" onclick="sendVibration('${user.socketId}', event)" title="Notify user">ğŸ””</button>`
                    : '';

                userList += `
            <div class="userCard ${user.vote !== null || user.isMaster ? 'voted' : ''} ${breakClass} ${questionClass} ${awayClass} ${masterClass}" data-socket-id="${user.socketId}">
                ${vibrateButton}
                <div class="user-card-avatar">${userAvatar}</div>
                <h3>${user.name}${masterBadge}</h3>
                <p class="${revealedClass}">${voteDisplay}</p>
            </div>
        `;
            });

            document.getElementById("users").innerHTML = userList;
            // userCount display removed - not in HTML

            // Only hide statistics if votes haven't been revealed yet
            if (!votesRevealed) {
                document.getElementById('statisticsSection').style.display = 'none';
            }
        });



        socket.on('updateVotes', function (users, voters, statistics) {

            let userList = '';

            // Sort users: master first, then others
            const sortedUsers = Object.values(users).sort((a, b) => {
                if (a.isMaster) return -1;
                if (b.isMaster) return 1;
                return 0;
            });

            sortedUsers.forEach((user) => {
                const breakClass = user.requestBreak ? 'has-break-request' : '';
                const questionClass = user.hasQuestion ? 'has-question' : '';
                const awayClass = user.isAway ? 'is-away' : '';
                const masterClass = user.isMaster ? 'is-master' : '';
                // Master always shows emoji
                let voteDisplay;
                if (user.isMaster) {
                    voteDisplay = 'ğŸ¥º';
                } else if (user.isAway) {
                    voteDisplay = 'ğŸ’¤';
                } else if (user.vote === 'â˜•') {
                    voteDisplay = 'â˜•';
                } else if (user.vote !== null && user.vote !== 'null') {
                    voteDisplay = user.vote;
                } else {
                    voteDisplay = 'ğŸ¥º';
                }
                const masterBadge = user.isMaster ? ' ğŸ‘‘' : '';
                const userAvatar = user.avatar || 'ğŸ‘¤';
                const revealedClass = 'vote-revealed'; // Add special class for revealed votes

                // Add vibrate button only for Scrum Master and not for themselves
                const vibrateButton = (isMaster && !user.isMaster)
                    ? `<button class="vibrate-btn" onclick="sendVibration('${user.socketId}', event)" title="Notify user">ğŸ””</button>`
                    : '';

                userList += `
            <div class="userCard ${user.vote !== null || user.isMaster ? 'voted' : ''} ${breakClass} ${questionClass} ${awayClass} ${masterClass}" data-socket-id="${user.socketId}">
                ${vibrateButton}
                <div class="user-card-avatar">${userAvatar}</div>
                <h3>${user.name}${masterBadge}</h3>
                <p class="${revealedClass}">${voteDisplay}</p>
            </div>
        `;
            });

            document.getElementById("users").innerHTML = userList;
            // voters display removed - not needed

            // Show statistics section and update values
            if (statistics) {
                votesRevealed = true; // Mark votes as revealed
                document.getElementById('statisticsSection').style.display = 'flex';
                document.getElementById('mostCommonValue').textContent = statistics.median;
                document.getElementById('consensusValue').textContent = statistics.consensus;
            }
        });

        socket.on('pulseDetected', function () {
            console.log('pulseDetected');
        });

        socket.on('votesReset', function (users) {
            let userList = '';

            // Sort users: master first, then others
            const sortedUsers = Object.values(users).sort((a, b) => {
                if (a.isMaster) return -1;
                if (b.isMaster) return 1;
                return 0;
            });

            sortedUsers.forEach((user) => {
                const breakClass = user.requestBreak ? 'has-break-request' : '';
                const questionClass = user.hasQuestion ? 'has-question' : '';
                const awayClass = user.isAway ? 'is-away' : '';
                const masterClass = user.isMaster ? 'is-master' : '';
                const voteDisplay = user.isMaster ? 'Voted' : (user.isAway ? 'ğŸ’¤' : (user.vote !== null ? 'Voted' : 'Not voted'));
                const masterBadge = user.isMaster ? ' ğŸ‘‘' : '';
                const userAvatar = user.avatar || 'ğŸ‘¤';

                // Add vibrate button only for Scrum Master and not for themselves
                const vibrateButton = (isMaster && !user.isMaster)
                    ? `<button class="vibrate-btn" onclick="sendVibration('${user.socketId}', event)" title="Notify user">ğŸ””</button>`
                    : '';

                userList += `
            <div class="userCard ${user.vote !== null || user.isMaster ? 'voted' : ''} ${breakClass} ${questionClass} ${awayClass} ${masterClass}" data-socket-id="${user.socketId}">
                ${vibrateButton}
                <div class="user-card-avatar">${userAvatar}</div>
                <h3>${user.name}${masterBadge}</h3>
                <p>${voteDisplay}</p>
            </div>
        `;
            });

            document.getElementById("users").innerHTML = userList;
            // voters display removed - not needed

            // Re-enable reveal button and disable reset button
            document.getElementById('revealBtn').removeAttribute('disabled');
            document.getElementById('resetBtn').setAttribute('disabled', true);

            // Hide statistics section
            votesRevealed = false; // Reset voting state
            document.getElementById('statisticsSection').style.display = 'none';
            document.getElementById('mostCommonValue').textContent = '-';
            document.getElementById('consensusValue').textContent = '-';

            let voteButtons = document.querySelectorAll('.vote-btn');
            voteButtons.forEach(button => {
                button.classList.remove('active');
            });

            // Re-activate the current user's vote button if they have voted
            const currentUser = users[socket.id];
            if (currentUser && currentUser.vote !== null && currentUser.vote !== 'null') {
                voteButtons.forEach(button => {
                    if (button.textContent === String(currentUser.vote)) {
                        button.classList.add('active');
                    }
                });
            }

        });

        // Toggle vote function - allows deselecting
        function toggleVote(e, vote) {
            // Unlock audio on first vote interaction (backup for mobile browsers)
            if (!audioUnlocked) {
                unlockAudio();
            }

            const btn = e.target;
            const isActive = btn.classList.contains('active');

            // Remove active from all vote buttons
            let voteButtons = document.querySelectorAll('.vote-btn');
            voteButtons.forEach(button => {
                button.classList.remove('active');
            });

            // Reset revealed state when voting changes
            votesRevealed = false;
            document.getElementById('statisticsSection').style.display = 'none';

            if (isActive) {
                // Deselect - send null vote
                socket.emit('vote', { vote: null, room: currentRoom });
            } else {
                // Select new vote
                btn.classList.add('active');
                socket.emit('vote', { vote: vote, room: currentRoom });
            }
        }

        function showVotes() {
            socket.emit('showVotes', currentRoom);
            document.getElementById('resetBtn').removeAttribute('disabled'); // Butonu aktif hale getir
        }

        function resetVotes() {
            document.getElementById('resetBtn').setAttribute('disabled', true); // Butonu aktif hale getir

            let voteButtons = document.querySelectorAll('.vote-btn');
            voteButtons.forEach(button => {
                button.classList.remove('active');
            });

            socket.emit('resetVotes', currentRoom);


        }

        // Break request toggle
        function toggleBreakRequest() {
            // Unlock audio on interaction (backup for mobile browsers)
            if (!audioUnlocked) {
                unlockAudio();
            }

            const btn = document.getElementById('breakRequestBtn');
            const isActive = btn.classList.contains('active');

            if (isActive) {
                btn.classList.remove('active');
                socket.emit('breakRequest', { room: currentRoom, requestBreak: false });
            } else {
                btn.classList.add('active');
                socket.emit('breakRequest', { room: currentRoom, requestBreak: true });
            }
        }

        // Question toggle
        function toggleQuestion() {
            // Unlock audio on interaction (backup for mobile browsers)
            if (!audioUnlocked) {
                unlockAudio();
            }

            const btn = document.getElementById('questionBtn');
            const isActive = btn.classList.contains('active');

            if (isActive) {
                btn.classList.remove('active');
                socket.emit('question', { room: currentRoom, hasQuestion: false });
            } else {
                btn.classList.add('active');
                socket.emit('question', { room: currentRoom, hasQuestion: true });
            }
        }

        // Send vibration to specific user with button feedback
        function sendVibration(targetSocketId, event) {
            const button = event.currentTarget;

            // Add sending state
            button.classList.add('sending');
            button.textContent = 'âœ¨';

            // Vibrate the target user's card on Scrum Master's screen
            const targetCard = document.querySelector(`.userCard[data-socket-id="${targetSocketId}"]`);
            if (targetCard) {
                targetCard.classList.add('vibrating');
                setTimeout(() => {
                    targetCard.classList.remove('vibrating');
                }, 500);
            }

            // Play sound for Scrum Master too
            playNotificationSound();

            // Send vibration
            socket.emit('sendVibration', { room: currentRoom, targetSocketId: targetSocketId });

            // Reset button after animation
            setTimeout(() => {
                button.classList.remove('sending');
                button.textContent = 'ğŸ””';
            }, 600);
        }

        // Initialize and unlock audio for mobile browsers
        function initializeAudio() {
            if (!notificationAudio) {
                notificationAudio = new Audio('nudge.mp3');
                notificationAudio.volume = 0.7;
                // Preload the audio
                notificationAudio.load();
            }
            return notificationAudio;
        }

        // Unlock audio on first user interaction (required for mobile browsers)
        function unlockAudio() {
            if (audioUnlocked) return;

            const audio = initializeAudio();
            // Play and immediately pause to unlock audio context
            const playPromise = audio.play();
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    audio.pause();
                    audio.currentTime = 0;
                    audioUnlocked = true;
                    console.log('Audio unlocked for mobile browser');
                }).catch(error => {
                    console.log('Audio unlock failed:', error);
                });
            }
        }

        // Play MSN Messenger nudge sound
        function playNotificationSound() {
            const audio = initializeAudio();

            // Reset audio to start
            audio.currentTime = 0;

            const playPromise = audio.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.log('Audio playback failed:', error);
                    // Try to unlock audio if it failed
                    if (!audioUnlocked) {
                        console.log('Attempting to unlock audio...');
                    }
                });
            }
        }

        // Receive vibration
        socket.on('receiveVibration', function(data) {
            // Play MSN-style notification sound (always play, regardless of DOM state)
            playNotificationSound();

            const userCard = document.querySelector(`.userCard[data-socket-id="${socket.id}"]`);
            if (userCard) {
                userCard.classList.add('vibrating');

                // Remove animation class after animation completes
                setTimeout(() => {
                    userCard.classList.remove('vibrating');
                }, 500);
            }

            console.log(`Vibration received from Scrum Master!`);
        });


        // Manuel pulse mekanizmasÄ± kaldÄ±rÄ±ldÄ±
        // Socket.io'nun kendi ping/pong mekanizmasÄ± yeterli

    </script>


</head>

<body>

    <!-- Theme Toggle (Fixed position, always visible) -->
    <div class="theme-toggle-container">
        <div class="theme-toggle-switch" onclick="toggleTheme()">
            <div class="theme-toggle-slider">
                <span id="themeIcon">ğŸŒ™</span>
            </div>
        </div>
    </div>

    <!-- Join Section (Login Screen) -->
    <div class="join-section" id="joinSection">
        <div class="join-container">
            <div class="join-header">
                <h1>Scrum Poker</h1>
            </div>

            <div class="form-group">
                <label for="username">Your Name</label>
                <input type="text" id="username" placeholder="Enter your name" required>
            </div>

            <div class="form-group">
                <label for="room">Room Name</label>
                <input type="text" id="room" value="ecm" placeholder="Enter room name" required>
            </div>

            <div class="recommended-rooms-container">
                <label>Recommended Rooms</label>
                <div class="room-chips">
                    <button class="room-chip" onclick="selectRoom('ECM-Gryffindor')">ECM-Gryffindor</button>
                    <button class="room-chip" onclick="selectRoom('ECM-Hufflepuff')">ECM-Hufflepuff</button>
                </div>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="isMaster">
                <label for="isMaster">Join as Scrum Master</label>
            </div>

            <div class="avatar-section">
                <span class="avatar-section-label">Choose Avatar</span>
                <div class="avatar-grid">
                    <label class="avatar-option selected">
                        <input type="radio" name="avatar" value="ğŸ‘¤" checked>
                        <span>ğŸ‘¤</span>
                    </label>
                    <label class="avatar-option">
                        <input type="radio" name="avatar" value="ğŸ‘¨â€ğŸ’¼">
                        <span>ğŸ‘¨â€ğŸ’¼</span>
                    </label>
                    <label class="avatar-option">
                        <input type="radio" name="avatar" value="ğŸ‘©â€ğŸ’»">
                        <span>ğŸ‘©â€ğŸ’»</span>
                    </label>
                    <label class="avatar-option">
                        <input type="radio" name="avatar" value="ğŸ§‘â€ğŸ’»">
                        <span>ğŸ§‘â€ğŸ’»</span>
                    </label>
                    <label class="avatar-option">
                        <input type="radio" name="avatar" value="ğŸ§™â€â™‚ï¸">
                        <span>ğŸ§™â€â™‚ï¸</span>
                    </label>
                    <label class="avatar-option">
                        <input type="radio" name="avatar" value="ğŸ¦¸">
                        <span>ğŸ¦¸</span>
                    </label>
                    <label class="avatar-option">
                        <input type="radio" name="avatar" value="ğŸ±">
                        <span>ğŸ±</span>
                    </label>
                    <label class="avatar-option">
                        <input type="radio" name="avatar" value="ğŸ¶">
                        <span>ğŸ¶</span>
                    </label>
                    <label class="avatar-option">
                        <input type="radio" name="avatar" value="ğŸ¦">
                        <span>ğŸ¦</span>
                    </label>
                    <label class="avatar-option">
                        <input type="radio" name="avatar" value="ğŸ¦Š">
                        <span>ğŸ¦Š</span>
                    </label>
                </div>
            </div>

            <button class="join-button" onclick="joinRoom()">Join Room</button>
        </div>
    </div>

    <!-- What's New Button -->
    <button class="whats-new-button" id="whatsNewButton" onclick="toggleWhatsNew()">
        âœ¨ What's New?
    </button>

    <!-- What's New Modal -->
    <div class="whats-new-modal" id="whatsNewModal">
        <div class="whats-new-modal-content">
            <div class="whats-new-modal-header">
                <h2 class="whats-new-title">What's New? âœ¨</h2>
                <button class="close-modal" onclick="toggleWhatsNew()">&times;</button>
            </div>
            <ul class="whats-new-list">
                <li>ğŸ¨ <strong>Complete UI/UX Redesign:</strong> Modern, clean interface with smooth animations and premium button interactions</li>
                <li>ğŸŒ“ <strong>Enhanced Dark Mode:</strong> Elegant theme toggle with smooth transitions between light and dark modes</li>
                <li>ğŸ‘¤ <strong>Custom Avatars:</strong> Choose from 10 unique avatars that display throughout your session</li>
                <li>â° <strong>6-Hour Session Persistence:</strong> Your session data is saved for 6 hours - close your browser and come back anytime</li>
                <li>ğŸ”„ <strong>5-Minute Reconnection Grace:</strong> If you disconnect temporarily, you have 5 minutes to reconnect without losing your spot</li>
                <li>ğŸ”™ <strong>Quick Return to Login:</strong> Click on your user info box in the lobby to instantly return to the login screen</li>
                <li>â˜• <strong>Break & Question Indicators:</strong> Subtle emoji badges appear on user avatars when requesting breaks or asking questions</li>
                <li>ğŸ¯ <strong>Flexible Voting:</strong> Change or deselect your vote anytime before the Scrum Master reveals results</li>
                <li>ğŸ“Š <strong>Voting Statistics:</strong> Automatic calculation of Average, Most Common, and Consensus percentage when votes are revealed (excludes Scrum Master votes)</li>
                <li>ğŸ”” <strong>MSN Messenger-Style Notifications:</strong> Scrum Masters can send instant vibration alerts to team members with sound effects and visual feedback</li>
                <li>âœ¨ <strong>Premium Button Interactions:</strong> Satisfying haptic-like feedback animations with color transitions and state changes</li>
                <li>ğŸ“ˆ <strong>Prominent Vote Display:</strong> When votes are revealed, they appear large and clear for easy consensus building</li>
                <li>ğŸª <strong>Long Name Support:</strong> User names of any length display elegantly without truncation throughout the interface</li>
            </ul>
        </div>
    </div>

    <!-- Game Section (Lobby Screen) -->
    <div id="gameSection" class="game-section d-none">
        <div class="container">
            <div class="header-area">
                <div class="user-info-section" onclick="returnToLogin()" title="Click to return to login screen">
                    <div class="user-avatar-display" id="userAvatarDisplay">ğŸ‘¤</div>
                    <div class="user-details-display">
                        <h2 id="userNameDisplay">User</h2>
                        <p id="userRoomDisplay">Room: -</p>
                    </div>
                </div>

                <div class="page-title">
                    <h1>Scrum Poker</h1>
                </div>
            </div>

            <div class="divider"></div>

            <div class="voting-section">
                <div class="voting-controls">
                    <div class="vote-buttons">
                        <button class="vote-btn" onclick="toggleVote(event, 0)">0</button>
                        <button class="vote-btn" onclick="toggleVote(event, 1)">1</button>
                        <button class="vote-btn" onclick="toggleVote(event, 2)">2</button>
                        <button class="vote-btn" onclick="toggleVote(event, 3)">3</button>
                        <button class="vote-btn" onclick="toggleVote(event, 5)">5</button>
                        <button class="vote-btn" onclick="toggleVote(event, 8)">8</button>
                        <button class="vote-btn" onclick="toggleVote(event, 13)">13</button>
                        <button class="vote-btn" onclick="toggleVote(event, 21)">21</button>
                        <button class="vote-btn" onclick="toggleVote(event, 40)">40</button>
                        <button class="vote-btn" onclick="toggleVote(event, 'â˜•')">â˜•</button>
                    </div>
                    <div class="request-buttons">
                        <button id="breakRequestBtn" class="request-btn" onclick="toggleBreakRequest()">
                            â˜• Request Break
                        </button>
                        <button id="questionBtn" class="request-btn" onclick="toggleQuestion()">
                            â“ Question
                        </button>
                    </div>
                </div>

                <!-- Statistics Section (shown only when votes are revealed) -->
                <div id="statisticsSection" class="statistics-section" style="display: none;">
                    <div class="stat-card">
                        <div class="stat-label">ğŸ¯ Most Common</div>
                        <div class="stat-value" id="mostCommonValue">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ğŸ¤ Consensus</div>
                        <div class="stat-value" id="consensusValue">-</div>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <div class="section-master master-controls d-none">
                <button
                    id="revealBtn"
                    class="master-btn"
                    onclick="showVotes()"
                    style="display: none;"
                >Reveal Votes</button>

                <button
                    id="resetBtn"
                    class="master-btn danger"
                    onclick="resetVotes()"
                    style="display: none;"
                    disabled
                >Restart</button>
            </div>

            <div id="userContainer">
                <div class="users-grid" id="users"></div>
            </div>
        </div>
    </div>

</body>

</html>